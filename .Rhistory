knitr::opts_chunk$set(echo = TRUE)
devtools::unload()
devtools::load_all()
data(mouse_hypothalamus)
new_reference <- appendPlaceholder(mouse_hypothalamus$reference, numPlaceholder=1)
p <- visualizeReference(new_reference)
p
color = c('Astrocyte'='red', 'Endothelial'='orange',
'Ependymal'='black', 'Excitatory'='blue',
'Inhibitory'='green', 'Microglia'='purple',
'OD Immature'='yellow', 'OD Mature'='brown',
'Pericytes'='cyan')
legend_labels <- names(color)
legend_colors <- as.vector(color)
legend_grob <- getLegendGrob(legend_labels, legend_colors)
plotDeconvRes(mouse_hypothalamus$ground_truth_deconv,
mouse_hypothalamus$spatial_meta,
color = color,
numRow = 1,
numCol = 2,
legend_grob = legend_grob)
cellType = 'OD Mature'
cellType_idx = which(colnames(mouse_hypothalamus$ground_truth_deconv) == cellType)
plotDeconvRes(mouse_hypothalamus$ground_truth_deconv,
mouse_hypothalamus$spatial_meta,
color = color,
numRow = 1,
numCol = 2,
topic = cellType_idx,
r=4)
prior_const = c(rep(5, 8), 0.1)
output = runFlexiDeconv(as.matrix(mouse_hypothalamus$spatial),
new_reference,
prior_const)
usethis::use_description(fields = list(
Title = "Flexible Cell Type Deconvolution Method for Spatial Transcriptomics",
Description = "FlexiDeconv is a semi supervised cell type deconvolution method
that infers cell type proportions across pixels by flexibly leveraging the
reference, which consists of cell type gene expression profiles typically
derived from scRNA-seq data. Even though the reference is used, FlexiDeconv
still actively estimates cell type gene expression profiles from the Spatial
Transcriptomics data. FlexiDeconv allows users to assign weights to the
provided cell type gene expression profiles, reflecting the extent to which
reference contributes to estimating gene expression relative to the ST data."
))
usethis::use_gpl3_license()
usethis::use_package("STdeconvolve", type = "Imports")
usethis::use_package("Matrix", type = "Imports")
d <- desc::desc("DESCRIPTION")
d$set(Authors@R = 'c(
d$set(Authors@R <- 'c(
person("Yichen", "Jiang", email = "yichenjiang0626@gmail.com", role = c("aut","cre")),
person("Heejung", "Shim", email = "heejung.shim@unimelb.edu.au", role = c("aut"))
)')
d$set(Authors@R = 'c(
d$set(`Authors@R` = 'c(
person("Yichen", "Jiang", email = "yichenjiang0626@gmail.com", role = c("aut","cre")),
person("Heejung", "Shim", email = "heejung.shim@unimelb.edu.au", role = "aut")
)')
d$write()
usethis::use_package("bayess", type = "Imports")
usethis::use_package("pheatmap", type = "Imports")
usethis::use_package("ggplot2", type = "Imports")
usethis::use_package("gridExtra", type = "Imports")
getRversion()
devtools::check()
install.packages("pkgload")
devtools::check()
knitr::opts_chunk$set(echo = TRUE)
devtools::unload()
devtools::load_all()
data(mouse_hypothalamus)
new_reference <- appendPlaceholder(mouse_hypothalamus$reference, numPlaceholder=1)
p <- visualizeReference(new_reference)
p
devtools::check()
devtools::check()
devtools::check()
devtools::check()
usethis::use_vignette("vignette")
devtools::check()
knitr::opts_chunk$set(echo = TRUE)
myRCTD = readRDS("../../Data/ovarianCancer/results/RCTD_healthy_s1.rds")
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res = deconv_res/rowSums(deconv_res)
library(stringr)
library(STdeconvolve)
library(ggplot2)
library(SPARK)
library(spacexr)
library(Seurat)
library(png)
source("../functions(new).R")
spatial <- readMM("../../Data/ovarianCancer/rawDataFiles/GSM6506110_SP1_matrix.mtx")
barcodes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506110_SP1_barcodes.tsv", header = F)
genes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506110_SP1_features.tsv", header = F)
location <- read.csv("../../Data/ovarianCancer/rawDataFiles/GSM6506110_SP1_spatial/spatial/tissue_positions_list.csv", header=F)
colnames(spatial) <- barcodes$V1
rownames(spatial) <- genes$V2
unique_genes = unique(genes$V2)
spatial_loc <- data.frame(
x = location$V5, y = location$V6
)
rownames(spatial_loc) = location$V1
spatial_loc = spatial_loc[colnames(spatial),]
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res = deconv_res/rowSums(deconv_res)
#rownames(deconv_res) <- substring(rownames(deconv_res), 2)
pixels_selected = rownames(deconv_res)
curr_deconv_res <- deconv_res[pixels_selected, ]
colors_provide = rep("black", ncol(deconv_res))
names(colors_provide) = colnames(deconv_res)
pos = data.frame(x = spatial_loc[rownames(curr_deconv_res),]$y,
y = 50000 - spatial_loc[rownames(curr_deconv_res),]$x)
rownames(pos) = rownames(curr_deconv_res)
for (i in 1:ncol(deconv_res)) {
new_col = colors_provide
new_col[i] = 'red'
p = vizTopic(as.matrix(curr_deconv_res), pos=pos, size=2, topic = i, plotTitle = names(colors_provide)[i])
plot(p)
}
myRCTD = readRDS("../../Data/ovarianCancer/results/RCTD_healthy.rds")
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res = deconv_res/rowSums(deconv_res)
#rownames(deconv_res) <- substring(rownames(deconv_res), 2)
pixels_selected = rownames(deconv_res)
curr_deconv_res <- deconv_res[pixels_selected, ]
colors_provide = rep("black", ncol(deconv_res))
names(colors_provide) = colnames(deconv_res)
pos = data.frame(x = spatial_loc[rownames(curr_deconv_res),]$y,
y = 50000 - spatial_loc[rownames(curr_deconv_res),]$x)
rownames(pos) = rownames(curr_deconv_res)
for (i in 1:ncol(deconv_res)) {
new_col = colors_provide
new_col[i] = 'red'
p = vizTopic(as.matrix(curr_deconv_res), pos=pos, size=2, topic = i, plotTitle = names(colors_provide)[i])
plot(p)
}
dim(deconv_res)
library(stringr)
library(STdeconvolve)
library(ggplot2)
library(SPARK)
library(spacexr)
library(Seurat)
library(png)
source("../functions(new).R")
spatial <- readMM("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_matrix.mtx")
barcodes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_barcodes.tsv", header = F)
genes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_features.tsv", header = F)
location <- read.csv("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_spatial/spatial/tissue_positions_list.csv", header=F)
colnames(spatial) <- barcodes$V1
rownames(spatial) <- genes$V2
unique_genes = unique(genes$V2)
spatial_loc <- data.frame(
x = location$V5, y = location$V6
)
rownames(spatial_loc) = location$V1
spatial_loc = spatial_loc[colnames(spatial),]
myRCTD = readRDS("../../Data/ovarianCancer/results/RCTD_healthy.rds")
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res = deconv_res/rowSums(deconv_res)
#rownames(deconv_res) <- substring(rownames(deconv_res), 2)
pixels_selected = rownames(deconv_res)
curr_deconv_res <- deconv_res[pixels_selected, ]
colors_provide = rep("black", ncol(deconv_res))
names(colors_provide) = colnames(deconv_res)
pos = data.frame(x = spatial_loc[rownames(curr_deconv_res),]$y,
y = 50000 - spatial_loc[rownames(curr_deconv_res),]$x)
rownames(pos) = rownames(curr_deconv_res)
for (i in 1:ncol(deconv_res)) {
new_col = colors_provide
new_col[i] = 'red'
p = vizTopic(as.matrix(curr_deconv_res), pos=pos, size=2, topic = i, plotTitle = names(colors_provide)[i])
plot(p)
}
dim(spatial_loc)
pos
spatial <- readMM("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_matrix.mtx")
barcodes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_barcodes.tsv", header = F)
genes <- read.delim("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_features.tsv", header = F)
location <- read.csv("../../Data/ovarianCancer/rawDataFiles/GSM6506117_SP8_spatial/spatial/tissue_positions_list.csv", header=F)
colnames(spatial) <- barcodes$V1
rownames(spatial) <- genes$V2
unique_genes = unique(genes$V2)
spatial_loc <- data.frame(
x = location$V5, y = location$V6
)
rownames(spatial_loc) = location$V1
spatial_loc = spatial_loc[colnames(spatial),]
myRCTD = readRDS("../../Data/ovarianCancer/results/RCTD_healthy.rds")
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res[1;5,1:5]
deconv_res[1:5,1:5]
deconv_res = myRCTD@results$weights/rowSums(as.matrix(myRCTD@results$weights))
deconv_res = deconv_res/rowSums(deconv_res)
rownames(deconv_res) <- substring(rownames(deconv_res), 2)
pixels_selected = rownames(deconv_res)
curr_deconv_res <- deconv_res[pixels_selected, ]
colors_provide = rep("black", ncol(deconv_res))
names(colors_provide) = colnames(deconv_res)
pos = data.frame(x = spatial_loc[rownames(curr_deconv_res),]$y,
y = 50000 - spatial_loc[rownames(curr_deconv_res),]$x)
rownames(pos) = rownames(curr_deconv_res)
for (i in 1:ncol(deconv_res)) {
new_col = colors_provide
new_col[i] = 'red'
p = vizTopic(as.matrix(curr_deconv_res), pos=pos, size=2, topic = i, plotTitle = names(colors_provide)[i])
plot(p)
}
knitr::opts_chunk$set(echo = TRUE)
library(stringr)
library(STdeconvolve)
library(ggplot2)
library(SPARK)
library(spacexr)
library(Seurat)
library(png)
source("../functions(new).R")
results <- readRDS("../../Data/ovarianCancer/results/STdeconvolve_res_slide8.rds")
deconProp <- results$theta
deconGexp <- results$beta
deconv_res = deconProp
colors_provide = rep("black", ncol(deconProp))
names(colors_provide) = colnames(deconProp)
pos = data.frame(x = spatial_loc[rownames(deconProp),]$y,
y = 50000 - spatial_loc[rownames(deconProp),]$x)
rownames(pos) = rownames(deconProp)
for (i in 1:ncol(deconProp)) {
new_col = colors_provide
new_col[i] = 'red'
p = vizTopic(as.matrix(deconProp), pos=pos, size=2, topic = i, plotTitle = names(colors_provide)[i])
plot(p)
}
?vizAllTopics
?runFlexiDeconv
?runFlexiDeconv
?runFlexiDeconv
devtools::check()
devtools::check()
devtools::check()
.Last.error
.Last.error
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
?vizAllTopics
devtools::check()
devtools::document()
devtools::document()
devtools::document()
devtools::check()
devtools::check()
devtools::check()
devtools::check()
